<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Students</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <h2>Manage Students</h2>

    <!-- Filter Form -->
    <form method="GET" class="mb-4">
        <div class="row">
            <div class="col">
                <label>Course</label>
                <select name="course" class="form-control">
                    <option value="">All</option>
                    {% for course in courses %}
                        <option value="{{ course.id }}" {% if course.id|stringformat:"s" == request.GET.course %}selected{% endif %}>
                            {{ course.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>Session</label>
                <select name="session" class="form-control">
                    <option value="">All</option>
                    {% for session in sessions %}
                        <option value="{{ session.id }}" {% if session.id|stringformat:"s" == request.GET.session %}selected{% endif %}>
                            {{ session.name }} - {{ session.course.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>Semester</label>
                <select name="semester" class="form-control">
                    <option value="">All</option>
                    {% for semester in semesters %}
                        <option value="{{ semester.id }}" {% if semester.id|stringformat:"s" == request.GET.semester %}selected{% endif %}>
                            {{ semester.name }} - {{ semester.session.name }} - {{ semester.course.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-primary form-control">Filter</button>
            </div>
        </div>
    </form>

    <!-- add student and bulk upload buttons -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{% url 'add_student' %}" class="btn btn-success">+ Add Student</a>

        <!-- bulk upload form -->
        <form method="POST" enctype="multipart/form-data" action="{% url 'bulk_add_students' %}">
            {% csrf_token %}
            <input type="hidden" name="course" value="{{ request.GET.course }}">
            <input type="hidden" name="session" value="{{ request.GET.session }}">
            <input type="hidden" name="semester" value="{{ request.GET.semester }}">
            <input type="file" name="excel_file" accept=".xlsx" required>
            <button type="submit" class="btn btn-secondary">Upload Excel</button>
        </form>
    </div>

    <!-- promote students form -->
    <form method="POST" action="{% url 'promote_students' %}">
        {% csrf_token %}

        <!-- hidden inputs -->
        <input type="hidden" name="course_id" value="{{ request.GET.course }}">
        <input type="hidden" name="session_id" value="{{ request.GET.session }}">
        <input type="hidden" name="semester_id" value="{{ request.GET.semester }}">

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th><input type="checkbox" id="select_all"></th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Enrollment Number</th>
                    <th>Course</th>
                    <th>Session</th>
                    <th>Semester</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td><input type="checkbox" name="selected_students" value="{{ student.id }}"></td>
                    <td>{{ student.user.username }}</td>
                    <td>{{ student.user.email }}</td>
                    <td>{{ student.enrollment_number }}</td>
                    <td>{{ student.course.name }}</td>
                    <td>{{ student.session.name }}</td>
                    <td>{{ student.semester.name }}</td>
                    <td>
                        <a href="{% url 'edit_student' student.id %}" class="btn btn-primary btn-sm me-1">Edit</a>
                        <a href="{% url 'delete_student' student.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?');">Delete</a>
                    </td>
                    
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8">No students found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button type="submit" class="btn btn-warning mt-2">Promote Selected Students</button>
    </form>
</div>

<script>
    document.getElementById('select_all').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll('input[name="selected_students"]');
        checkboxes.forEach(cb => cb.checked = this.checked);
    });
</script>
</body>
</html>

